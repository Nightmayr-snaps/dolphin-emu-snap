#!/bin/bash

set -x

if [ ! -z "$KDE_FULL_SESSION" ]; then
  unset KDE_FULL_SESSION
fi

if echo "$XDG_CURRENT_DESKTOP" | grep -q KDE; then
  unset XDG_CURRENT_DESKTOP
else
  export QT_QPA_PLATFORMTHEME=gtk3
fi

echo "LD_LIBRARY_PATH before substring removal: $LD_LIBRARY_PATH"
# Workaround for impish Nvidia discussed here:
#  - https://forum.snapcraft.io/t/egl-using-snaps-on-impish-seem-to-be-broken-when-using-the-nvidia-proprietary-driver/25715
export LD_LIBRARY_PATH="${LD_LIBRARY_PATH#$SNAP_LIBRARY_PATH:}"
export LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:${SNAP_LIBRARY_PATH}"

echo "LD_LIBRARY_PATH after substring removal: $LD_LIBRARY_PATH"

set +x

exec "${@}"